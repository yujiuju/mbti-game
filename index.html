<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- ç§»åŠ¨ç«¯é€‚é…ï¼šç¦æ­¢ç¼©æ”¾ï¼Œç¡®ä¿è§¦æ‘¸äº¤äº’æ­£å¸¸ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- iOSç‰¹å®šè®¾ç½®ï¼šå¯ç”¨å…¨å±æ¨¡å¼ï¼ŒçŠ¶æ€æ é€æ˜ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MBTI è§’è‰²è¿çº¿</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", "Arial Bold", sans-serif;
        }

        /* é¡µé¢ä¸»ä½“ï¼šå‚ç›´å±…ä¸­å¸ƒå±€ï¼Œæ¸å˜èƒŒæ™¯ */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(180deg, #4a7c59 0%, #81b29a 50%, #f2cc8f 100%);
            padding: 10px;
            background-attachment: fixed;
            overflow: hidden;
            position: relative;
            -webkit-tap-highlight-color: transparent; /* æ¸…é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }

        /* æ¸¸æˆæ ‡é¢˜ */
        .game-title {
            text-align: center;
            font-size: clamp(28px, 6vw, 40px);
            font-weight: 900;
            color: #ffffff;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin: 15px 0 25px;
            background: rgba(74, 124, 89, 0.7);
            padding: 10px 20px;
            border-radius: 12px;
            letter-spacing: 2px;
            z-index: 10;
            position: relative;
        }

        /* æ¸¸æˆä¸»å®¹å™¨ */
        .game-container {
            position: relative;
            width: 100%;
            max-width: 850px;
            height: 70vh;
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #4a7c59;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            overflow: hidden;
            z-index: 10;
        }

        /* å®¹å™¨èƒŒæ™¯é®ç½© */
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://picsum.photos/id/142/850/600') center/cover no-repeat;
            opacity: 0.1;
            z-index: 0;
        }

        /* å·¦å³å®¹å™¨åŒ…è£… */
        .items-wrapper {
            display: flex;
            height: 100%;
            padding: 15px 10px;
            gap: clamp(15px, 4vw, 25px);
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        /* å·¦å³é€‰é¡¹æ  */
        .left-items, .right-items {
            position: relative;
            z-index: 2;
            flex-shrink: 0;
            width: clamp(90px, 18vw, 140px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 12px;
        }

        /* é€‰é¡¹å¡ç‰‡åŸºç¡€æ ·å¼ */
        .item-card {
            width: 100%;
            min-height: 80px;
            padding: 10px 8px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: linear-gradient(90deg, #81b29a 0%, #4a7c59 100%);
            border-radius: 10px;
            font-size: clamp(14px, 2.5vw, 16px);
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            position: relative;
            user-select: none;
            border: 2px solid #ffffff;
            touch-action: none;
        }

        /* å¡ç‰‡æ‚¬åœ/æ¿€æ´»çŠ¶æ€ */
        .item-card:hover, .item-card.active-state {
            transform: translateY(-4px) scale(1.08);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            background: linear-gradient(90deg, #f2cc8f 0%, #e07a5f 100%);
        }

        /* å¡ç‰‡é€‰ä¸­çŠ¶æ€ */
        .item-card.selected {
            background: linear-gradient(90deg, #e07a5f 0%, #4a7c59 100%);
            border: 2px solid #f2cc8f;
            transform: scale(1.05);
        }

        /* å·¦å³å¡ç‰‡ç»Ÿä¸€æ ·å¼ */
        .left-card, .right-card {
            gap: 8px;
            font-size: clamp(14px, 2.5vw, 16px);
            letter-spacing: normal;
            text-transform: none;
        }

        /* å¡ç‰‡å¤´åƒä¼ªå…ƒç´  */
        .left-card::before, .right-card::before {
            content: '';
            display: block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* è§’è‰²å¤´åƒæ˜ å°„ */
        .left-card[data-id="1"]::before { background-image: url('https://picsum.photos/id/1025/40/40'); }
        .left-card[data-id="2"]::before { background-image: url('https://picsum.photos/id/1074/40/40'); }
        .left-card[data-id="3"]::before { background-image: url('https://picsum.photos/id/1062/40/40'); }
        .left-card[data-id="4"]::before { background-image: url('https://picsum.photos/id/1005/40/40'); }
        
        /* MBTIå›¾æ ‡æ˜ å°„ */
        .right-card[data-answer="a"]::before { background-image: url('ENFJ.JPG'); }
        .right-card[data-answer="b"]::before { background-image: url('ENTP.JPG'); }
        .right-card[data-answer="c"]::before { background-image: url('ISTP.JPG'); }
        .right-card[data-answer="d"]::before { background-image: url('INFJ.JPG'); }

        /* ä¸­é—´è¿çº¿åŒºåŸŸ */
        .connect-area {
            flex: 1;
            position: relative;
            cursor: crosshair;
            max-width: 450px;
            min-width: 120px;
        }

        /* SVGå®¹å™¨ */
        .svg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* è¿çº¿åŸºç¡€æ ·å¼ */
        .line-path, .temp-line-path {
            fill: none;
            stroke-width: 4px;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* æ­£å¼è¿çº¿ */
        .line-path {
            stroke: #4a7c59;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 1.2s ease-out forwards;
        }

        /* ä¸´æ—¶é¢„è§ˆçº¿ */
        .temp-line-path {
            stroke: #81b29a;
            opacity: 0.8;
        }

        /* è¿çº¿ç»˜åˆ¶åŠ¨ç”» */
        @keyframes dash {
            to { stroke-dashoffset: 0; }
        }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            margin-top: 20px;
            padding: 12px 35px;
            font-size: clamp(16px, 3vw, 18px);
            font-weight: bold;
            background: linear-gradient(90deg, #e07a5f 0%, #4a7c59 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 80%;
            max-width: 320px;
            box-shadow: 0 4px 12px rgba(74, 124, 89, 0.4);
            letter-spacing: 1px;
            z-index: 10;
            position: relative;
            touch-action: none;
        }

        .submit-btn:hover, .submit-btn.active-state {
            transform: scale(1.06);
            box-shadow: 0 6px 16px rgba(74, 124, 89, 0.6);
            background: linear-gradient(90deg, #f2cc8f 0%, #e07a5f 100%);
        }

        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ========== çƒŸèŠ±ç‰¹æ•ˆå®¹å™¨ï¼ˆæ–°å¢ï¼‰ ========== */
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* ä¸æ‹¦æˆªç”¨æˆ·äº¤äº’ */
            z-index: 1800; /* ä»‹äºå°é»„äººå’Œå°ä¸‘ä¹‹é—´ */
            overflow: hidden; /* é˜²æ­¢ç²’å­æº¢å‡ºå±å¹• */
            display: none; /* åˆå§‹éšè— */
        }

        /* çƒŸèŠ±ç²’å­åŸºç¡€æ ·å¼ */
        .firework-particle {
            position: absolute;
            border-radius: 50%; /* åœ†å½¢ç²’å­ */
            pointer-events: none;
            opacity: 0; /* åˆå§‹é€æ˜ */
            /* CSSå˜é‡å®šä¹‰ï¼Œç”¨äºåŠ¨æ€æ§åˆ¶ç²’å­å±æ€§ */
            --particle-size: 6px; /* ç²’å­å¤§å° */
            --particle-color: #fff; /* ç²’å­é¢œè‰² */
            --duration: 2s; /* åŠ¨ç”»æŒç»­æ—¶é—´ */
            --delay: 0s; /* åŠ¨ç”»å»¶è¿Ÿæ—¶é—´ */
        }

        /* çƒŸèŠ±å†²å‡»æ³¢æ ·å¼ */
        .shockwave {
            position: absolute;
            border-radius: 50%; /* åœ†å½¢å†²å‡»æ³¢ */
            pointer-events: none;
            opacity: 0; /* åˆå§‹é€æ˜ */
            border: 2px solid rgba(255, 255, 255, 0.8); /* ç™½è‰²è¾¹æ¡†å¸¦é€æ˜åº¦ */
            transform: scale(0); /* åˆå§‹ç¼©æ”¾ä¸º0 */
        }

        /* çƒŸèŠ±çˆ†ç‚¸ä¸­å¿ƒç‚¹ */
        .explosion-center {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%); /* ä¸­å¿ƒå®šä½ */
            background: radial-gradient(circle, #FFD700 0%, #FF4500 70%, transparent 100%);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            z-index: 1801;
        }

        /* ========== å°é»„äººç‰¹æ•ˆå®¹å™¨ ========== */
        .minions-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* ä¸æ‹¦æˆªç”¨æˆ·äº¤äº’ */
            z-index: 2000; /* æœ€é«˜å±‚çº§ */
            overflow: hidden; /* é˜²æ­¢å…ƒç´ æº¢å‡ºå±å¹• */
            display: none; /* åˆå§‹éšè— */
        }

        /* ========== å°é»„äººæ ·å¼ ========== */
        .minion {
            position: absolute;
            width: 120px; /* å°é»„äººå®½åº¦ */
            height: 180px; /* å°é»„äººé«˜åº¦ */
            bottom: -200px; /* åˆå§‹ä½ç½®åœ¨å±å¹•ä¸‹æ–¹ */
            animation-duration: 3s; /* åŠ¨ç”»æ€»æ—¶é•¿ */
            animation-timing-function: ease-out; /* ç¼“å‡ºæ•ˆæœ */
            animation-fill-mode: forwards; /* ä¿æŒç»“æŸçŠ¶æ€ */
            z-index: 2001; /* åœ¨å°é»„äººå®¹å™¨å†…æœ€é«˜ */
        }

        /* å°é»„äººèº«ä½“ */
        .minion-body {
            position: absolute;
            width: 100%;
            height: 140px; /* èº«ä½“é«˜åº¦ */
            bottom: 0;
            background-color: #FFD800; /* å°é»„äººæ ‡å¿—æ€§é»„è‰² */
            border-radius: 60px 60px 40px 40px; /* åœ†æ¶¦çš„èº«ä½“å½¢çŠ¶ */
            overflow: hidden;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.3), /* å¤–éƒ¨é˜´å½± */
                inset 0 -10px 20px rgba(139, 69, 19, 0.2); /* å†…éƒ¨é˜´å½±å¢åŠ ç«‹ä½“æ„Ÿ */
        }

        /* å°é»„äººèƒŒå¸¦è£¤ */
        .minion-overalls {
            position: absolute;
            width: 100%;
            height: 60px; /* èƒŒå¸¦è£¤é«˜åº¦ */
            bottom: 0;
            background-color: #2A52BE; /* è“è‰²èƒŒå¸¦è£¤ */
            border-radius: 0 0 40px 40px; /* åº•éƒ¨åœ†è§’ */
            border-top: 8px solid #1E3A8A; /* èƒŒå¸¦è£¤ä¸Šè¾¹è£…é¥° */
        }

        /* èƒŒå¸¦ */
        .minion-strap {
            position: absolute;
            width: 12px; /* èƒŒå¸¦å®½åº¦ */
            height: 40px; /* èƒŒå¸¦é•¿åº¦ */
            top: -48px; /* ä»èº«ä½“é¡¶éƒ¨å¼€å§‹ */
            background-color: #2A52BE; /* è“è‰²ä¸èƒŒå¸¦è£¤ä¸€è‡´ */
        }

        /* å·¦èƒŒå¸¦ */
        .minion-strap.left {
            left: 25%;
            transform: translateX(-50%) rotate(5deg); /* è½»å¾®æ—‹è½¬ */
        }

        /* å³èƒŒå¸¦ */
        .minion-strap.right {
            right: 25%;
            transform: translateX(50%) rotate(-5deg); /* è½»å¾®æ—‹è½¬ */
        }

        /* å°é»„äººå¤´éƒ¨ */
        .minion-head {
            position: absolute;
            width: 130px; /* å¤´éƒ¨æ¯”èº«ä½“ç•¥å®½ */
            height: 100px; /* å¤´éƒ¨é«˜åº¦ */
            top: -80px; /* ä½äºèº«ä½“ä¸Šæ–¹ */
            left: 50%;
            transform: translateX(-50%);
            background-color: #FFD800; /* é»„è‰²ä¸èº«ä½“ä¸€è‡´ */
            border-radius: 50%; /* åœ†å½¢å¤´éƒ¨ */
            z-index: 2; /* åœ¨èº«ä½“ä¸Šæ–¹ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* å¤´éƒ¨é˜´å½± */
        }

        /* å°é»„äººæŠ¤ç›®é•œ */
        .minion-goggles {
            position: absolute;
            width: 100px; /* æŠ¤ç›®é•œå®½åº¦ */
            height: 70px; /* æŠ¤ç›®é•œé«˜åº¦ */
            top: 15px; /* å¤´éƒ¨å†…ä½ç½® */
            left: 50%;
            transform: translateX(-50%);
            background-color: #6A5ACD; /* æŠ¤ç›®é•œæ·±è“è‰² */
            border-radius: 35px; /* æ¤­åœ†å½¢ */
            overflow: hidden;
            border: 5px solid #4B0082; /* æŠ¤ç›®é•œè¾¹æ¡† */
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.5), /* å†…éƒ¨é˜´å½± */
                0 3px 10px rgba(0, 0, 0, 0.3); /* å¤–éƒ¨é˜´å½± */
        }

        /* æŠ¤ç›®é•œå†…éƒ¨ */
        .goggles-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #87CEEB; /* æµ…è“è‰²é•œç‰‡ */
            border-radius: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* å°é»„äººçœ¼ç› */
        .minion-eye {
            position: absolute;
            width: 25px; /* çœ¼ç›å¤§å° */
            height: 25px;
            background-color: #000000; /* é»‘è‰²çœ¼ç› */
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            animation: eye-blink 2s infinite; /* çœ¨çœ¼åŠ¨ç”» */
        }

        /* å·¦çœ¼ */
        .minion-eye.left {
            left: 25px;
        }

        /* å³çœ¼ */
        .minion-eye.right {
            right: 25px;
        }

        /* å°é»„äººå˜´å·´ */
        .minion-mouth {
            position: absolute;
            width: 40px; /* å˜´å·´å®½åº¦ */
            height: 20px; /* å˜´å·´é«˜åº¦ */
            bottom: 25px; /* å¤´éƒ¨å†…ä½ç½® */
            left: 50%;
            transform: translateX(-50%);
            background-color: #8B4513; /* æ£•è‰²å˜´å·´ */
            border-radius: 0 0 20px 20px; /* å¾®ç¬‘å½¢çŠ¶ */
            overflow: hidden;
        }

        /* å˜´å·´å†…éƒ¨ï¼ˆèˆŒå¤´ï¼‰ */
        .mouth-inner {
            position: absolute;
            width: 100%;
            height: 10px;
            background-color: #FF6B6B; /* çº¢è‰²èˆŒå¤´ */
            border-radius: 0 0 10px 10px;
            top: 0;
        }

        /* å°é»„äººæ‰‹éƒ¨ */
        .minion-hand {
            position: absolute;
            width: 25px; /* æ‰‹éƒ¨å®½åº¦ */
            height: 60px; /* æ‰‹éƒ¨é•¿åº¦ */
            background-color: #FFD800; /* é»„è‰²ä¸èº«ä½“ä¸€è‡´ */
            bottom: 80px; /* ä½äºèƒŒå¸¦è£¤ä¸Šæ–¹ */
            border-radius: 12px; /* åœ†æ¶¦çš„æ‰‹éƒ¨ */
            z-index: 1; /* åœ¨èº«ä½“ä¸‹æ–¹ */
        }

        /* å·¦æ‰‹ */
        .minion-hand.left {
            left: -15px;
            transform: rotate(30deg); /* å·¦æ‰‹è§’åº¦ */
        }

        /* å³æ‰‹ */
        .minion-hand.right {
            right: -15px;
            transform: rotate(-30deg); /* å³æ‰‹è§’åº¦ */
        }

        /* å°é»„äººè…¿éƒ¨ */
        .minion-leg {
            position: absolute;
            width: 25px; /* è…¿éƒ¨å®½åº¦ */
            height: 40px; /* è…¿éƒ¨é•¿åº¦ */
            background-color: #2A52BE; /* è“è‰²ä¸èƒŒå¸¦è£¤ä¸€è‡´ */
            bottom: 0;
            border-radius: 10px 10px 0 0; /* é¡¶éƒ¨åœ†è§’ */
        }

        /* å·¦è…¿ */
        .minion-leg.left {
            left: 35%;
            transform: translateX(-50%);
        }

        /* å³è…¿ */
        .minion-leg.right {
            right: 35%;
            transform: translateX(50%);
        }

        /* ========== å°ä¸‘ç‰¹æ•ˆå®¹å™¨ï¼ˆå¤±è´¥ç‰¹æ•ˆï¼‰ ========== */
        .clown-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* ä¸æ‹¦æˆªç”¨æˆ·äº¤äº’ */
            z-index: 1500; /* æ¯”çƒŸèŠ±å±‚çº§æ›´é«˜ */
            overflow: hidden; /* é˜²æ­¢å…ƒç´ æº¢å‡ºå±å¹• */
            display: none; /* åˆå§‹éšè— */
        }

        /* ========== æˆåŠŸæ–‡å­—æç¤ºï¼ˆå°é»„äººä¸“ç”¨ï¼‰ ========== */
        .success-message-minions {
            position: fixed;
            top: 15%; /* å±å¹•é¡¶éƒ¨ä½ç½® */
            left: 50%;
            transform: translateX(-50%) scale(0); /* åˆå§‹ç¼©æ”¾ä¸º0ï¼Œæ°´å¹³å±…ä¸­ */
            font-size: clamp(32px, 7vw, 56px); /* å“åº”å¼å­—ä½“å¤§å° */
            font-weight: 900; /* è¶…ç²—ä½“ */
            text-align: center; /* å±…ä¸­æ–‡æœ¬ */
            color: #FFD800; /* å°é»„äººä¸»é¢˜é»„è‰² */
            pointer-events: none; /* ä¸æ‹¦æˆªç”¨æˆ·äº¤äº’ */
            z-index: 2002; /* é«˜äºå°é»„äºº */
            text-shadow: 
                3px 3px 0 #2A52BE, /* è“è‰²é˜´å½± */
                6px 6px 0 rgba(0, 0, 0, 0.3); /* æ·±è‰²é˜´å½±å¢åŠ ç«‹ä½“æ„Ÿ */
            letter-spacing: 3px; /* å­—é—´è· */
            padding: 20px 40px; /* å†…è¾¹è· */
            border-radius: 20px; /* åœ†è§’ */
            display: none; /* åˆå§‹éšè— */
            white-space: nowrap; /* ä¸æ¢è¡Œ */
            background: rgba(255, 255, 255, 0.95); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            box-shadow: 
                0 10px 30px rgba(255, 216, 0, 0.5), /* é»„è‰²å…‰æ™• */
                inset 0 0 20px rgba(42, 82, 190, 0.2); /* è“è‰²å†…å‘å…‰ */
            animation: minions-text-bounce 1s 1.5s infinite alternate; /* å¼¹è·³åŠ¨ç”» */
        }

        /* ========== åŠ¨ç”»å®šä¹‰ ========== */

        /* çƒŸèŠ±çˆ†ç‚¸åŠ¨ç”» */
        @keyframes firework-explode {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            10% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.2);
                --tx: calc(var(--x-velocity) * 1.5);
                --ty: calc(var(--y-velocity) * 1.5);
            }
        }

        /* çƒŸèŠ±å†²å‡»æ³¢åŠ¨ç”» */
        @keyframes shockwave-expand {
            0% {
                opacity: 1;
                transform: scale(0);
            }
            90% {
                opacity: 0.1;
            }
            100% {
                opacity: 0;
                transform: scale(3);
            }
        }

        /* çˆ†ç‚¸ä¸­å¿ƒç‚¹åŠ¨ç”» */
        @keyframes center-explode {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(2);
            }
        }

        /* å°é»„äººè·³è·ƒåŠ¨ç”» */
        @keyframes minion-jump {
            0% {
                transform: translateX(var(--start-x)) translateY(0) rotate(0deg);
                bottom: -200px; /* èµ·å§‹ä½ç½®åœ¨å±å¹•ä¸‹æ–¹ */
            }
            20% {
                transform: translateX(var(--start-x)) translateY(-20px) rotate(-5deg);
                bottom: 50vh; /* å¿«é€Ÿä¸Šå‡ */
            }
            40% {
                transform: translateX(var(--mid-x)) translateY(-150px) rotate(10deg);
                bottom: 60vh; /* åˆ°è¾¾è·³è·ƒé¡¶ç‚¹ */
            }
            60% {
                transform: translateX(var(--mid-x)) translateY(-100px) rotate(-8deg);
                bottom: 40vh; /* å¼€å§‹ä¸‹è½ */
            }
            80% {
                transform: translateX(var(--end-x)) translateY(-50px) rotate(5deg);
                bottom: 30vh; /* ç»§ç»­ä¸‹è½ */
            }
            100% {
                transform: translateX(var(--end-x)) translateY(0) rotate(0deg);
                bottom: 20vh; /* æœ€ç»ˆä½ç½® */
            }
        }

        /* å°é»„äººæŒ¥æ‰‹åŠ¨ç”» */
        @keyframes minion-wave {
            0%, 100% {
                transform: rotate(30deg); /* å·¦æ‰‹åˆå§‹è§’åº¦ */
            }
            50% {
                transform: rotate(60deg); /* æŒ¥æ‰‹åŠ¨ä½œ */
            }
        }

        /* å°é»„äººæŒ¥æ‰‹åŠ¨ç”»ï¼ˆå³æ‰‹ï¼‰ */
        @keyframes minion-wave-right {
            0%, 100% {
                transform: rotate(-30deg); /* å³æ‰‹åˆå§‹è§’åº¦ */
            }
            50% {
                transform: rotate(-60deg); /* æŒ¥æ‰‹åŠ¨ä½œ */
            }
        }

        /* å°é»„äººçœ¨çœ¼åŠ¨ç”» */
        @keyframes eye-blink {
            0%, 90%, 100% {
                height: 25px; /* çœ¼ç›æ­£å¸¸å¤§å° */
            }
            92%, 98% {
                height: 2px; /* çœ¨çœ¼æ—¶çœ¼ç›å˜ç»† */
            }
        }

        /* å°é»„äººæ–‡å­—å¼¹è·³åŠ¨ç”» */
        @keyframes minions-text-bounce {
            0%, 100% {
                transform: translateX(-50%) translateY(0) scale(1);
            }
            50% {
                transform: translateX(-50%) translateY(-15px) scale(1.05);
            }
        }

        /* å°é»„äººæ–‡å­—å‡ºç°åŠ¨ç”» */
        @keyframes minions-text-appear {
            0% {
                transform: translateX(-50%) scale(0) rotate(-10deg);
                opacity: 0;
            }
            70% {
                transform: translateX(-50%) scale(1.1) rotate(5deg);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* å°é»„äººæ–‡å­—æ¶ˆå¤±åŠ¨ç”» */
        @keyframes minions-text-disappear {
            0% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) scale(0.8);
                opacity: 0;
            }
        }

        /* ========== å¤±è´¥ç‰¹æ•ˆï¼ˆä¿ç•™åŸæœ‰ï¼‰ ========== */
        /* å°ä¸‘æ ·å¼ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
        .clown-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0); /* åˆå§‹ç¼©æ”¾ä¸º0 */
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #ff3366, #ff9966);
            border-radius: 50%;
            animation: clown-appear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards,
                       clown-shake 1.5s 0.8s infinite alternate;
            box-shadow: 
                0 0 50px rgba(255, 51, 102, 0.6),
                0 0 100px rgba(255, 153, 102, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.3);
            z-index: 1501;
        }

        .clown-eye {
            position: absolute;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            top: 60px;
            overflow: hidden;
        }

        .clown-eye.left {
            left: 45px;
        }

        .clown-eye.right {
            right: 45px;
        }

        .clown-pupil {
            position: absolute;
            width: 25px;
            height: 25px;
            background: #333;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: eye-roll 2s 1s infinite alternate;
        }

        .clown-nose {
            position: absolute;
            width: 30px;
            height: 40px;
            background: #ff3366;
            border-radius: 50%;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            animation: nose-bounce 0.8s 0.5s infinite alternate;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 -5px 10px rgba(0, 0, 0, 0.1);
        }

        .clown-mouth {
            position: absolute;
            width: 100px;
            height: 50px;
            background: #ff3366;
            border-radius: 0 0 50px 50px;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            overflow: hidden;
            animation: mouth-open 1.2s 0.3s infinite alternate;
        }

        .mouth-inner-clown {
            position: absolute;
            width: 100%;
            height: 30px;
            background: #ff6699;
            border-radius: 0 0 30px 30px;
            top: 0;
            left: 0;
        }

        .clown-hat {
            position: absolute;
            width: 140px;
            height: 60px;
            background: #3366ff;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50% 50% 0 0;
            box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.2);
            animation: hat-tilt 1.2s 0.7s infinite alternate;
        }

        .hat-pompom {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #ffcc00;
            border-radius: 50%;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            animation: pompom-bounce 0.6s 0.9s infinite alternate;
        }

        /* å¤±è´¥æ–‡å­—æç¤º */
        .fail-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0); /* åˆå§‹ç¼©æ”¾ä¸º0ï¼Œå±…ä¸­ */
            font-size: clamp(28px, 6vw, 48px);
            font-weight: 900;
            text-align: center;
            color: #ff3366;
            pointer-events: none;
            z-index: 1600; /* é«˜äºå°ä¸‘ */
            text-shadow: 
                3px 3px 0 #ffcc00,
                6px 6px 0 rgba(0, 0, 0, 0.2);
            letter-spacing: 2px;
            padding: 15px 30px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 
                0 10px 30px rgba(255, 51, 102, 0.4),
                inset 0 0 20px rgba(255, 204, 0, 0.3);
            display: none;
            white-space: nowrap;
            animation: fail-text-pulse 1.2s 0.6s infinite alternate;
        }

        .fail-decoration {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffcc00;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            z-index: 1502;
        }

        /* ========== å¤±è´¥åŠ¨ç”»ï¼ˆä¿ç•™åŸæœ‰ï¼‰ ========== */
        @keyframes clown-appear {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            70% {
                transform: translate(-50%, -50%) scale(1.1) rotate(10deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes clown-shake {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            25% {
                transform: translate(-50%, -50%) scale(1.05) rotate(-5deg);
            }
            75% {
                transform: translate(-50%, -50%) scale(1.05) rotate(5deg);
            }
        }

        @keyframes eye-roll {
            0%, 100% {
                transform: translate(-50%, -50%);
            }
            33% {
                transform: translate(-70%, -50%);
            }
            66% {
                transform: translate(-30%, -50%);
            }
        }

        @keyframes nose-bounce {
            0%, 100% {
                transform: translateX(-50%) scale(1);
            }
            50% {
                transform: translateX(-50%) scale(1.2);
            }
        }

        @keyframes mouth-open {
            0%, 100% {
                height: 50px;
                border-radius: 0 0 50px 50px;
            }
            50% {
                height: 70px;
                border-radius: 0 0 70px 70px;
            }
        }

        @keyframes hat-tilt {
            0%, 100% {
                transform: translateX(-50%) rotate(0deg);
            }
            50% {
                transform: translateX(-50%) rotate(15deg);
            }
        }

        @keyframes pompom-bounce {
            0%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            50% {
                transform: translateX(-50%) translateY(-10px);
            }
        }

        @keyframes fail-text-pulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                color: #ff3366;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.05);
                color: #ff6699;
            }
        }

        @keyframes fail-text-appear {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-10deg);
                opacity: 0;
            }
            70% {
                transform: translate(-50%, -50%) scale(1.1) rotate(5deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes decoration-fly-in {
            0% {
                opacity: 0;
                transform: translate(var(--start-x), var(--start-y)) scale(0) rotate(0deg);
            }
            70% {
                opacity: 1;
                transform: translate(var(--mid-x), var(--mid-y)) scale(1.2) rotate(180deg);
            }
            100% {
                opacity: 0.8;
                transform: translate(var(--end-x), var(--end-y)) scale(1) rotate(360deg);
            }
        }

        @keyframes screen-red-flash {
            0%, 100% {
                background-color: transparent;
            }
            20% {
                background-color: rgba(255, 51, 102, 0.3);
            }
            40% {
                background-color: rgba(255, 153, 102, 0.2);
            }
            60% {
                background-color: rgba(255, 51, 102, 0.1);
            }
        }

        /* ========== å“åº”å¼é€‚é… ========== */
        
        /* å¹³æ¿/å¤§å±æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            .game-container {
                height: 65vh;
            }
            .left-items, .right-items {
                width: clamp(80px, 16vw, 120px);
                gap: 10px;
            }
            .connect-area {
                max-width: none;
                min-width: 100px;
            }
            .item-card {
                min-height: 70px;
                padding: 8px 6px;
            }
            .left-card::before, .right-card::before {
                width: 35px;
                height: 35px;
            }
            
            /* å°é»„äººå“åº”å¼ */
            .minion {
                width: 90px;
                height: 135px;
            }
            .minion-body {
                height: 105px;
                border-radius: 45px 45px 30px 30px;
            }
            .minion-head {
                width: 100px;
                height: 75px;
                top: -60px;
            }
            .minion-goggles {
                width: 75px;
                height: 52px;
                top: 10px;
            }
            .minion-eye {
                width: 18px;
                height: 18px;
            }
            .minion-eye.left {
                left: 18px;
            }
            .minion-eye.right {
                right: 18px;
            }
            .success-message-minions {
                font-size: clamp(24px, 5vw, 40px);
                padding: 15px 30px;
                white-space: normal;
                line-height: 1.3;
            }
            
            /* çƒŸèŠ±å“åº”å¼ */
            .firework-particle {
                --particle-size: 4px;
            }
            
            /* å°ä¸‘å“åº”å¼ */
            .clown-face {
                width: 150px;
                height: 150px;
            }
            .clown-eye {
                width: 30px;
                height: 30px;
                top: 45px;
            }
            .clown-eye.left {
                left: 35px;
            }
            .clown-eye.right {
                right: 35px;
            }
            .clown-nose {
                top: 75px;
                width: 25px;
                height: 35px;
            }
            .clown-mouth {
                width: 80px;
                bottom: 40px;
            }
            .clown-hat {
                width: 110px;
                height: 50px;
                top: -35px;
            }
            .fail-message {
                font-size: clamp(24px, 5vw, 36px);
                padding: 12px 24px;
                white-space: normal;
                line-height: 1.3;
            }
        }

        /* å°å±æ‰‹æœºé€‚é… */
        @media (max-width: 375px) {
            .game-title {
                font-size: 24px;
                padding: 8px 15px;
            }
            .game-container {
                height: 60vh;
            }
            .items-wrapper {
                gap: 8px;
                padding: 10px 5px;
            }
            .left-items, .right-items {
                gap: 8px;
            }
            .item-card {
                min-height: 65px;
                font-size: clamp(12px, 2vw, 14px);
            }
            .left-card::before, .right-card::before {
                width: 40px;
                height: 40px;
            }
            
            /* å°é»„äººå“åº”å¼ */
            .minion {
                width: 70px;
                height: 105px;
            }
            .minion-body {
                height: 80px;
                border-radius: 35px 35px 25px 25px;
            }
            .minion-head {
                width: 80px;
                height: 60px;
                top: -50px;
            }
            .minion-goggles {
                width: 60px;
                height: 40px;
                top: 8px;
            }
            .minion-eye {
                width: 15px;
                height: 15px;
            }
            .minion-eye.left {
                left: 15px;
            }
            .minion-eye.right {
                right: 15px;
            }
            .success-message-minions {
                font-size: clamp(20px, 4vw, 32px);
                padding: 10px 20px;
                white-space: normal;
            }
            
            /* çƒŸèŠ±å“åº”å¼ */
            .firework-particle {
                --particle-size: 3px;
            }
            
            /* å°ä¸‘å“åº”å¼ */
            .clown-face {
                width: 120px;
                height: 120px;
            }
            .clown-eye {
                width: 25px;
                height: 25px;
                top: 35px;
            }
            .clown-eye.left {
                left: 25px;
            }
            .clown-eye.right {
                right: 25px;
            }
            .clown-nose {
                top: 60px;
                width: 20px;
                height: 30px;
            }
            .clown-mouth {
                width: 60px;
                height: 40px;
                bottom: 30px;
            }
            .clown-hat {
                width: 90px;
                height: 40px;
                top: -30px;
            }
            .fail-message {
                font-size: clamp(20px, 4vw, 28px);
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- æ¸¸æˆæ ‡é¢˜ -->
    <h2 class="game-title">MBTI è§’è‰²è¿çº¿</h2>
    
    <!-- æ¸¸æˆä¸»å®¹å™¨ -->
    <div class="game-container">
        <div class="items-wrapper">
            <!-- å·¦ä¾§è§’è‰²å¡ç‰‡ -->
            <div class="left-items">
                <div class="item-card left-card" data-id="1">äººå‘˜A</div>
                <div class="item-card left-card" data-id="2">äººå‘˜B</div>
                <div class="item-card left-card" data-id="3">äººå‘˜C</div>
                <div class="item-card left-card" data-id="4">äººå‘˜D</div>
            </div>
            
            <!-- ä¸­é—´è¿çº¿åŒºåŸŸ -->
            <div class="connect-area" id="connectArea">
                <svg class="svg-container" id="svgContainer"></svg>
            </div>
            
            <!-- å³ä¾§MBTIå¡ç‰‡ -->
            <div class="right-items">
                <div class="item-card right-card" data-answer="a">ENFJ</div>
                <div class="item-card right-card" data-answer="b">ENTP</div>
                <div class="item-card right-card" data-answer="c">ISTP</div>
                <div class="item-card right-card" data-answer="d">INFJ</div>
            </div>
        </div>
    </div>
    
    <!-- æäº¤æŒ‰é’® -->
    <button class="submit-btn" id="submitBtn" disabled>æäº¤ç­”æ¡ˆ</button>
    
    <!-- çƒŸèŠ±ç‰¹æ•ˆå®¹å™¨ï¼ˆæ–°å¢ï¼‰ -->
    <div class="fireworks-container" id="fireworksContainer"></div>
    
    <!-- å°é»„äººç‰¹æ•ˆå®¹å™¨ -->
    <div class="minions-container" id="minionsContainer"></div>
    
    <!-- å°ä¸‘ç‰¹æ•ˆå®¹å™¨ï¼ˆå¤±è´¥ç‰¹æ•ˆï¼‰ -->
    <div class="clown-container" id="clownContainer"></div>
    
    <!-- å¤±è´¥æ–‡å­—æç¤º -->
    <div class="fail-message" id="failMessage">ğŸ˜­ ç­”é”™äº†ï¼å†æ¥ä¸€æ¬¡ï¼</div>
    
    <!-- æˆåŠŸæ–‡å­—æç¤ºï¼ˆå°é»„äººä¸“ç”¨ï¼‰ -->
    <div class="success-message-minions" id="successMessageMinions">ğŸ‰ å¤ªæ£’äº†ï¼å…¨éƒ¨æ­£ç¡®ï¼ ğŸ‰</div>
    
    <!-- éŸ³æ•ˆï¼ˆé¢„åŠ è½½ï¼‰ -->
    <audio id="successSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="failSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-cartoon-falling-whistle-392.mp3" type="audio/mpeg">
    </audio>
    
    <!-- å°é»„äººåº†ç¥éŸ³æ•ˆ -->
    <audio id="minionsSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-funny-cartoon-jump-257.mp3" type="audio/mpeg">
    </audio>
    
    <!-- çƒŸèŠ±éŸ³æ•ˆï¼ˆæ–°å¢ï¼‰ -->
    <audio id="fireworksSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-fireworks-explosion-1652.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ========== å…¨å±€å¸¸é‡/å˜é‡å®šä¹‰ ==========
        
        /**
         * æ­£ç¡®ç­”æ¡ˆæ˜ å°„è¡¨
         * æ ¼å¼ï¼šè§’è‰²ID -> MBTIç­”æ¡ˆID
         * 1: äººå‘˜A -> ENTP (b)
         * 2: äººå‘˜B -> INFJ (d)
         * 3: äººå‘˜C -> ENFJ (a)
         * 4: äººå‘˜D -> ISTP (c)
         */
        const correctAnswers = {
            1: 'b',
            2: 'd',
            3: 'a',
            4: 'c'
        };

        const userAnswers = {}; // å­˜å‚¨ç”¨æˆ·ç­”æ¡ˆï¼š{è§’è‰²ID: MBTIç±»å‹}
        let isDragging = false; // æ‹–æ‹½çŠ¶æ€æ ‡è®°ï¼štrue=æ­£åœ¨æ‹–æ‹½
        let startItem = null;   // æ‹–æ‹½èµ·å§‹å¡ç‰‡ï¼ˆå·¦ä¾§è§’è‰²å¡ç‰‡ï¼‰
        let tempLinePath = null;// ä¸´æ—¶é¢„è§ˆè¿çº¿ï¼ˆSVGè·¯å¾„å…ƒç´ ï¼‰

        // DOMå…ƒç´ å¼•ç”¨
        const fireworksContainer = document.getElementById('fireworksContainer'); // çƒŸèŠ±å®¹å™¨ï¼ˆæ–°å¢ï¼‰
        const minionsContainer = document.getElementById('minionsContainer'); // å°é»„äººå®¹å™¨
        const clownContainer = document.getElementById('clownContainer'); // å°ä¸‘å®¹å™¨
        const failMessage = document.getElementById('failMessage'); // å¤±è´¥æ–‡å­—æç¤º
        const successMessageMinions = document.getElementById('successMessageMinions'); // æˆåŠŸæ–‡å­—æç¤ºï¼ˆå°é»„äººä¸“ç”¨ï¼‰
        const successSound = document.getElementById('successSound'); // æˆåŠŸéŸ³æ•ˆ
        const failSound = document.getElementById('failSound'); // å¤±è´¥éŸ³æ•ˆ
        const minionsSound = document.getElementById('minionsSound'); // å°é»„äººéŸ³æ•ˆ
        const fireworksSound = document.getElementById('fireworksSound'); // çƒŸèŠ±éŸ³æ•ˆï¼ˆæ–°å¢ï¼‰
        const connectArea = document.getElementById('connectArea'); // è¿çº¿åŒºåŸŸ
        const svgContainer = document.getElementById('svgContainer'); // SVGå®¹å™¨
        const submitBtn = document.getElementById('submitBtn'); // æäº¤æŒ‰é’®
        const allCards = document.querySelectorAll('.item-card'); // æ‰€æœ‰å¡ç‰‡

        // ========== åˆå§‹åŒ–å‡½æ•° ==========
        
        /**
         * é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
         * åŠŸèƒ½ï¼šè®¾ç½®SVGå°ºå¯¸ã€ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
         */
        function init() {
            resizeSVG(); // åˆå§‹åŒ–SVGå°ºå¯¸
            window.addEventListener('resize', resizeSVG); // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´SVG
            submitBtn.addEventListener('click', handleSubmit); // æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            bindTouchEvents(); // ç»‘å®šç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
            bindDragEvents();   // ç»‘å®šæ‹–æ‹½äº‹ä»¶
        }

        // ========== ç§»åŠ¨ç«¯è§¦æ‘¸äº¤äº’äº‹ä»¶ç»‘å®š ==========
        
        /**
         * ç»‘å®šç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶ï¼Œæ¨¡æ‹ŸPCç«¯çš„hoveræ•ˆæœ
         * ä½¿ç”¨active-stateç±»æ›¿ä»£:hoverä¼ªç±»
         */
        function bindTouchEvents() {
            // ä¸ºæ‰€æœ‰å¡ç‰‡ç»‘å®šè§¦æ‘¸äº‹ä»¶
            allCards.forEach(card => {
                // è§¦æ‘¸å¼€å§‹ï¼šæ·»åŠ active-stateç±»ï¼Œæ˜¾ç¤ºæ‚¬åœæ•ˆæœ
                card.addEventListener('touchstart', (e) => {
                    if (!isDragging) { // æ‹–æ‹½è¿‡ç¨‹ä¸­ä¸è§¦å‘
                        card.classList.add('active-state');
                    }
                }, { passive: true }); // passive: trueæå‡è§¦æ‘¸æ»šåŠ¨æ€§èƒ½

                // ç§»é™¤active-stateç±»çš„é€šç”¨å‡½æ•°ï¼ˆå»¶è¿Ÿ100msæ¨¡æ‹Ÿå›å¼¹ï¼‰
                const removeActiveState = (e) => {
                    setTimeout(() => {
                        // å·²é€‰ä¸­æˆ–æ‹–æ‹½ä¸­çš„å¡ç‰‡ä¸ç§»é™¤active-state
                        if (!card.classList.contains('selected') && !isDragging) {
                            card.classList.remove('active-state');
                        }
                    }, 100);
                };

                // è§¦æ‘¸ç»“æŸï¼šç§»é™¤active-state
                card.addEventListener('touchend', removeActiveState);
                // è§¦æ‘¸å–æ¶ˆï¼ˆå¦‚æ¥ç”µã€ç¦»å¼€å±å¹•ï¼‰ï¼šç§»é™¤active-state
                card.addEventListener('touchcancel', removeActiveState);
                // è§¦æ‘¸ç§»åŠ¨ï¼šæ‰‹æŒ‡ç§»å‡ºå¡ç‰‡èŒƒå›´æ—¶ç«‹å³ç§»é™¤æ•ˆæœ
                card.addEventListener('touchmove', (e) => {
                    const rect = card.getBoundingClientRect(); // è·å–å¡ç‰‡è¾¹ç•Œ
                    const touch = e.touches[0]; // è·å–ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹
                    // åˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨å¡ç‰‡èŒƒå›´å†…
                    if (touch.clientX < rect.left || touch.clientX > rect.right || 
                        touch.clientY < rect.top || touch.clientY > rect.bottom) {
                        removeActiveState(); // ç§»å‡ºèŒƒå›´åˆ™ç§»é™¤æ•ˆæœ
                    }
                });
            });

            // æäº¤æŒ‰é’®è§¦æ‘¸äº‹ä»¶
            submitBtn.addEventListener('touchstart', (e) => {
                if (!submitBtn.disabled) { // æœªç¦ç”¨æ—¶æ‰æ·»åŠ æ•ˆæœ
                    submitBtn.classList.add('active-state');
                }
            }, { passive: true });

            // è§¦æ‘¸ç»“æŸï¼šå»¶è¿Ÿ100msç§»é™¤æŒ‰é’®æ•ˆæœ
            submitBtn.addEventListener('touchend', () => {
                setTimeout(() => {
                    submitBtn.classList.remove('active-state');
                }, 100);
            });

            // è§¦æ‘¸å–æ¶ˆï¼šç«‹å³ç§»é™¤æŒ‰é’®æ•ˆæœ
            submitBtn.addEventListener('touchcancel', () => {
                submitBtn.classList.remove('active-state');
            });
        }

        // ========== æ‹–æ‹½äº‹ä»¶ç»‘å®šï¼ˆPC/ç§»åŠ¨ç«¯å…¼å®¹ï¼‰ ==========
        
        /**
         * ç»‘å®šæ‹–æ‹½ç›¸å…³äº‹ä»¶ï¼ŒåŒæ—¶æ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸
         */
        function bindDragEvents() {
            // å¼€å§‹æ‹–æ‹½äº‹ä»¶
            allCards.forEach(card => {
                card.addEventListener('mousedown', startDrag); // PCç«¯ï¼šé¼ æ ‡æŒ‰ä¸‹
                // ç§»åŠ¨ç«¯ï¼šè§¦æ‘¸å¼€å§‹ï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆé¿å…é¡µé¢æ»šåŠ¨ï¼‰
                card.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
                    startDrag(e);
                }, { passive: false });
            });

            // æ‹–æ‹½ç§»åŠ¨äº‹ä»¶
            document.addEventListener('mousemove', dragMove); // PCç«¯ï¼šé¼ æ ‡ç§»åŠ¨
            // ç§»åŠ¨ç«¯ï¼šè§¦æ‘¸ç§»åŠ¨ï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸º
            document.addEventListener('touchmove', (e) => {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
                dragMove(e);
            }, { passive: false });

            // ç»“æŸæ‹–æ‹½äº‹ä»¶
            document.addEventListener('mouseup', endDrag);       // PCç«¯ï¼šé¼ æ ‡æ¾å¼€
            document.addEventListener('touchend', endDrag);      // ç§»åŠ¨ç«¯ï¼šè§¦æ‘¸ç»“æŸ
            document.addEventListener('touchcancel', endDrag);   // ç§»åŠ¨ç«¯ï¼šè§¦æ‘¸å–æ¶ˆ
        }

        /**
         * å¼€å§‹æ‹–æ‹½å¤„ç†å‡½æ•°
         * @param {Event} e - é¼ æ ‡æˆ–è§¦æ‘¸äº‹ä»¶
         */
        function startDrag(e) {
            // è·å–è§¦å‘äº‹ä»¶çš„å¡ç‰‡å…ƒç´ 
            const target = e.target || (e.touches && e.touches[0].target);
            startItem = target.closest('.item-card');

            // ä»…å…è®¸æ‹–æ‹½å·¦ä¾§è§’è‰²å¡ç‰‡
            if (!startItem || !startItem.closest('.left-items')) return;

            // è®¾ç½®æ‹–æ‹½çŠ¶æ€
            isDragging = true;
            startItem.classList.add('dragging', 'selected'); // æ·»åŠ æ‹–æ‹½å’Œé€‰ä¸­æ ·å¼
            startItem.classList.remove('active-state');      // ç§»é™¤è§¦æ‘¸æ•ˆæœï¼Œé¿å…å†²çª

            // åˆ›å»ºä¸´æ—¶é¢„è§ˆè¿çº¿
            tempLinePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            tempLinePath.setAttribute('class', 'temp-line-path');
            svgContainer.appendChild(tempLinePath);

            // æ›´æ–°ä¸´æ—¶è¿çº¿åˆå§‹ä½ç½®
            updateTempLine(e);
        }

        /**
         * æ‹–æ‹½ç§»åŠ¨å¤„ç†å‡½æ•°
         * @param {Event} e - é¼ æ ‡æˆ–è§¦æ‘¸äº‹ä»¶
         */
        function dragMove(e) {
            // éæ‹–æ‹½çŠ¶æ€æˆ–æ— èµ·å§‹å¡ç‰‡æ—¶ç›´æ¥è¿”å›
            if (!isDragging || !startItem || !tempLinePath) return;
            updateTempLine(e); // æ›´æ–°ä¸´æ—¶è¿çº¿ä½ç½®
        }

        /**
         * æ›´æ–°ä¸´æ—¶è¿çº¿åæ ‡
         * @param {Event} e - é¼ æ ‡æˆ–è§¦æ‘¸äº‹ä»¶
         */
        function updateTempLine(e) {
            // å…¼å®¹è§¦æ‘¸äº‹ä»¶ï¼šè·å–è§¦æ‘¸ç‚¹åæ ‡
            const touch = e.touches && e.touches[0];
            const clientX = touch ? touch.clientX : e.clientX;
            const clientY = touch ? touch.clientY : e.clientY;

            // è·å–å¡ç‰‡å’Œè¿çº¿åŒºåŸŸçš„è¾¹ç•Œä¿¡æ¯
            const startRect = startItem.getBoundingClientRect();
            const areaRect = connectArea.getBoundingClientRect();

            // è®¡ç®—å¡ç‰‡åœ¨SVGä¸­çš„ç›¸å¯¹åæ ‡ï¼ˆå¡ç‰‡å³ä¾§ä¸­ç‚¹ï¼‰
            const startX = startRect.right - areaRect.left;
            const startY = startRect.top + startRect.height/2 - areaRect.top;

            // è®¡ç®—è§¦æ‘¸ç‚¹åœ¨SVGä¸­çš„ç›¸å¯¹åæ ‡
            const endX = clientX - areaRect.left;
            const endY = clientY - areaRect.top;

            // æ ¹æ®å±å¹•å®½åº¦è°ƒæ•´æ›²çº¿å¼§åº¦
            const screenWidth = window.innerWidth;
            const curveOffset = screenWidth < 480 ? 25 : 35; // å°å±å¼§åº¦å°ï¼Œå¤§å±å¼§åº¦å¤§
            
            // è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹
            const controlX = (startX + endX) / 2;
            const controlY = (startY + endY) / 2 - curveOffset; // æ§åˆ¶ç‚¹ä¸Šç§»ï¼Œå½¢æˆå¼§å½¢

            // ç”Ÿæˆè´å¡å°”æ›²çº¿è·¯å¾„æ•°æ®
            const pathData = `M ${startX} ${startY} Q ${controlX} ${controlY}, ${endX} ${endY}`;
            tempLinePath.setAttribute('d', pathData); // è®¾ç½®SVGè·¯å¾„
        }

        /**
         * ç»“æŸæ‹–æ‹½å¤„ç†å‡½æ•°
         * @param {Event} e - é¼ æ ‡æˆ–è§¦æ‘¸äº‹ä»¶
         */
        function endDrag(e) {
            // éæ‹–æ‹½çŠ¶æ€æˆ–æ— èµ·å§‹å¡ç‰‡æ—¶ç›´æ¥è¿”å›
            if (!isDragging || !startItem || !tempLinePath) return;

            // ç§»é™¤ä¸´æ—¶è¿çº¿
            tempLinePath.remove();
            tempLinePath = null;
            startItem.classList.remove('dragging'); // ç§»é™¤æ‹–æ‹½æ ·å¼

            // è·å–ç»“æŸä½ç½®çš„åæ ‡
            const changedTouch = e.changedTouches && e.changedTouches[0];
            const clientX = changedTouch ? changedTouch.clientX : e.clientX;
            const clientY = changedTouch ? changedTouch.clientY : e.clientY;

            // æ‰¾åˆ°ç»“æŸä½ç½®çš„å…ƒç´ 
            const endElement = document.elementFromPoint(clientX, clientY);
            const endItem = endElement ? endElement.closest('.item-card') : null;

            // åˆ¤æ–­æ˜¯å¦æ‹–æ‹½åˆ°å³ä¾§MBTIå¡ç‰‡
            if (endItem && endItem.closest('.right-items')) {
                const questionId = startItem.dataset.id;    // è·å–è§’è‰²ID
                const answerId = endItem.dataset.answer;    // è·å–MBTIç­”æ¡ˆID

                // ç§»é™¤è¯¥MBTIç±»å‹ä¹‹å‰çš„è¿çº¿ï¼ˆé¿å…é‡å¤è¿çº¿ï¼‰
                Object.keys(userAnswers).forEach(qId => {
                    if (userAnswers[qId] === answerId) {
                        const oldStart = document.querySelector(`.left-card[data-id="${qId}"]`);
                        oldStart?.classList.remove('selected'); // ç§»é™¤æ—§å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
                        delete userAnswers[qId]; // åˆ é™¤æ—§ç­”æ¡ˆ
                    }
                });

                // å­˜å‚¨ç”¨æˆ·ç­”æ¡ˆ
                userAnswers[questionId] = answerId;
                // åˆ›å»ºæ­£å¼è¿çº¿
                createCurvedLine(startItem, endItem, questionId);
                // æ ‡è®°å¡ç‰‡ä¸ºé€‰ä¸­çŠ¶æ€
                startItem.classList.add('selected');
                endItem.classList.add('selected');
            } else {
                // æœªæ‹–æ‹½åˆ°æœ‰æ•ˆåŒºåŸŸï¼Œç§»é™¤é€‰ä¸­çŠ¶æ€
                startItem.classList.remove('selected');
            }

            // é‡ç½®æ‹–æ‹½çŠ¶æ€
            isDragging = false;
            startItem = null;

            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½å·²ä½œç­”
            checkAllAnswered();
        }

        // ========== è¿çº¿ç»˜åˆ¶å‡½æ•° ==========
        
        /**
         * åˆ›å»ºæ­£å¼å¼§å½¢è¿çº¿
         * @param {HTMLElement} fromItem - èµ·å§‹å¡ç‰‡ï¼ˆè§’è‰²ï¼‰
         * @param {HTMLElement} toItem - ç»“æŸå¡ç‰‡ï¼ˆMBTIï¼‰
         * @param {string} questionId - è§’è‰²IDï¼ˆç”¨äºæ ‡è®°è¿çº¿ï¼‰
         */
        function createCurvedLine(fromItem, toItem, questionId) {
            // ç§»é™¤è¯¥é¢˜ç›®çš„æ—§è¿çº¿
            const existingLines = svgContainer.querySelectorAll(`.line-path[data-question="${questionId}"]`);
            existingLines.forEach(line => line.remove());

            // è·å–å¡ç‰‡å’Œè¿çº¿åŒºåŸŸçš„è¾¹ç•Œä¿¡æ¯
            const fromRect = fromItem.getBoundingClientRect();
            const toRect = toItem.getBoundingClientRect();
            const areaRect = connectArea.getBoundingClientRect();

            // è®¡ç®—èµ·å§‹å¡ç‰‡åæ ‡ï¼ˆå³ä¾§ä¸­ç‚¹ï¼‰
            const startX = fromRect.right - areaRect.left;
            const startY = fromRect.top + fromRect.height/2 - areaRect.top;

            // è®¡ç®—ç»“æŸå¡ç‰‡åæ ‡ï¼ˆå·¦ä¾§ä¸­ç‚¹ï¼‰
            const endX = toRect.left - areaRect.left;
            const endY = toRect.top + toRect.height/2 - areaRect.top;

            // æ ¹æ®å±å¹•å®½åº¦è°ƒæ•´æ›²çº¿å¼§åº¦
            const screenWidth = window.innerWidth;
            const curveOffset = screenWidth < 480 ? 25 : 35;
            const controlX = (startX + endX) / 2;
            const controlY = (startY + endY) / 2 - curveOffset;

            // åˆ›å»ºSVGè¿çº¿å…ƒç´ 
            const linePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            linePath.setAttribute('class', 'line-path'); // æ­£å¼è¿çº¿æ ·å¼
            linePath.setAttribute('data-question', questionId); // æ ‡è®°æ‰€å±é¢˜ç›®
            linePath.setAttribute('d', `M ${startX} ${startY} Q ${controlX} ${controlY}, ${endX} ${endY}`); // è´å¡å°”æ›²çº¿è·¯å¾„
            svgContainer.appendChild(linePath); // æ·»åŠ åˆ°SVGå®¹å™¨
        }

        // ========== ç­”é¢˜çŠ¶æ€æ£€æŸ¥ ==========
        
        /**
         * æ£€æŸ¥æ˜¯å¦æ‰€æœ‰è§’è‰²éƒ½å·²è¿çº¿
         * @returns {boolean} æ˜¯å¦å…¨éƒ¨å®Œæˆ
         */
        function checkAllAnswered() {
            // éå†æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆçš„é”®ï¼Œæ£€æŸ¥æ˜¯å¦éƒ½åœ¨ç”¨æˆ·ç­”æ¡ˆä¸­
            const allAnswered = Object.keys(correctAnswers).every(id => userAnswers[id]);
            submitBtn.disabled = !allAnswered; // å…¨éƒ¨å®Œæˆåˆ™å¯ç”¨æäº¤æŒ‰é’®
        }

        // ========== çƒŸèŠ±ç‰¹æ•ˆå‡½æ•°ï¼ˆæ–°å¢ï¼‰ ==========
        
        /**
         * åˆ›å»ºå…¨å±çƒŸèŠ±ç‰¹æ•ˆ
         * ä¸å°é»„äººåŠ¨ç”»åŒæ—¶æ’­æ”¾ï¼Œå¢å¼ºåº†ç¥æ•ˆæœ
         */
        function createFireworks() {
            // æ¸…ç©ºä¹‹å‰çš„çƒŸèŠ±æ•ˆæœ
            fireworksContainer.innerHTML = '';
            // æ˜¾ç¤ºçƒŸèŠ±å®¹å™¨
            fireworksContainer.style.display = 'block';
            
            // è·å–å±å¹•å°ºå¯¸
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            // æ ¹æ®å±å¹•å°ºå¯¸ç¡®å®šçˆ†ç‚¸ä¸­å¿ƒæ•°é‡
            const explosionCount = screenWidth < 768 ? 4 : 6; // å°å±å¹•4ä¸ªï¼Œå¤§å±å¹•6ä¸ª
            
            // åˆ›å»ºå¤šä¸ªçˆ†ç‚¸ä¸­å¿ƒï¼Œå½¢æˆè¿ç¯çˆ†ç‚¸æ•ˆæœ
            for (let i = 0; i < explosionCount; i++) {
                // å»¶è¿Ÿæ¯ä¸ªçˆ†ç‚¸ä¸­å¿ƒçš„å‡ºç°æ—¶é—´ï¼Œå½¢æˆè¿ç»­çˆ†ç‚¸æ•ˆæœ
                setTimeout(() => {
                    // éšæœºç”Ÿæˆçˆ†ç‚¸ä¸­å¿ƒä½ç½®ï¼ˆé¿å¼€å±å¹•è¾¹ç¼˜ï¼‰
                    const centerX = Math.random() * (screenWidth * 0.8) + (screenWidth * 0.1);
                    const centerY = Math.random() * (screenHeight * 0.8) + (screenHeight * 0.1);
                    
                    // åˆ›å»ºçˆ†ç‚¸ä¸­å¿ƒç‚¹
                    createExplosionCenter(centerX, centerY);
                    
                    // åˆ›å»ºç²’å­çˆ†ç‚¸ï¼ˆä¸»æ•ˆæœï¼‰
                    createParticleExplosion(centerX, centerY);
                    
                    // åˆ›å»ºå†²å‡»æ³¢æ•ˆæœ
                    createShockwave(centerX, centerY);
                    
                    // æ’­æ”¾çƒŸèŠ±éŸ³æ•ˆï¼ˆæ¯ä¸ªçˆ†ç‚¸ç‚¹éƒ½æ’­æ”¾ï¼‰
                    playFireworksSound();
                    
                }, i * 400); // è¿ç¯çˆ†ç‚¸ï¼šæ¯ä¸ªçˆ†ç‚¸é—´éš”400ms
            }
            
            // 4.5ç§’åè‡ªåŠ¨éšè—çƒŸèŠ±å®¹å™¨ï¼ˆä¸å°é»„äººåŠ¨ç”»åŒæ­¥ï¼‰
            setTimeout(() => {
                fireworksContainer.style.display = 'none';
            }, 4500);
        }
        
        /**
         * åˆ›å»ºçˆ†ç‚¸ä¸­å¿ƒç‚¹
         * @param {number} x - Xåæ ‡
         * @param {number} y - Yåæ ‡
         */
        function createExplosionCenter(x, y) {
            const center = document.createElement('div');
            center.className = 'explosion-center';
            center.style.left = `${x}px`;
            center.style.top = `${y}px`;
            
            // éšæœºå¤§å°
            const size = 30 + Math.random() * 30;
            center.style.width = `${size}px`;
            center.style.height = `${size}px`;
            
            // åº”ç”¨çˆ†ç‚¸åŠ¨ç”»
            center.style.animation = `center-explode 1.2s ease-out forwards`;
            
            fireworksContainer.appendChild(center);
        }
        
        /**
         * åˆ›å»ºç²’å­çˆ†ç‚¸æ•ˆæœ
         * @param {number} centerX - çˆ†ç‚¸ä¸­å¿ƒXåæ ‡
         * @param {number} centerY - çˆ†ç‚¸ä¸­å¿ƒYåæ ‡
         */
        function createParticleExplosion(centerX, centerY) {
            // æ ¹æ®å±å¹•å°ºå¯¸ç¡®å®šç²’å­æ•°é‡
            const particleCount = window.innerWidth < 768 ? 80 : 150;
            
            // çƒŸèŠ±é¢œè‰²é›†åˆï¼ˆé²œè‰³å¤šå½©ï¼‰
            const colors = [
                '#FFD700', '#FF4500', '#00FFFF', '#FF1493', '#7CFC00',
                '#FF00FF', '#00FF00', '#FFA500', '#FFFFFF', '#9370DB',
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'
            ];
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                
                // éšæœºç²’å­å¤§å°
                const size = 2 + Math.random() * 6;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // éšæœºç²’å­é¢œè‰²
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºç²’å­è¿åŠ¨æ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const distance = 30 + Math.random() * 200; // éšæœºçˆ†ç‚¸èŒƒå›´
                
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                
                // è®¾ç½®CSSå˜é‡ç”¨äºåŠ¨ç”»æ§åˆ¶
                particle.style.setProperty('--x-velocity', `${endX}px`);
                particle.style.setProperty('--y-velocity', `${endY}px`);
                
                // è®¾ç½®ç²’å­åˆå§‹ä½ç½®
                particle.style.left = `${centerX}px`;
                particle.style.top = `${centerY}px`;
                
                // éšæœºåŠ¨ç”»å‚æ•°
                const delay = Math.random() * 0.3;
                const duration = 1.2 + Math.random() * 0.8;
                
                // åº”ç”¨çˆ†ç‚¸åŠ¨ç”»
                particle.style.animation = `
                    firework-explode ${duration}s ease-out ${delay}s forwards
                `;
                
                // éšæœºå±‚çº§
                particle.style.zIndex = Math.floor(Math.random() * 10) + 1;
                
                fireworksContainer.appendChild(particle);
            }
        }
        
        /**
         * åˆ›å»ºå†²å‡»æ³¢æ•ˆæœ
         * @param {number} x - Xåæ ‡
         * @param {number} y - Yåæ ‡
         */
        function createShockwave(x, y) {
            const shockwave = document.createElement('div');
            shockwave.className = 'shockwave';
            shockwave.style.left = `${x}px`;
            shockwave.style.top = `${y}px`;
            
            // éšæœºå†²å‡»æ³¢å¤§å°
            const size = 20 + Math.random() * 40;
            shockwave.style.width = `${size}px`;
            shockwave.style.height = `${size}px`;
            
            // éšæœºé¢œè‰²ï¼ˆä»é¢œè‰²é›†åˆä¸­é€‰å–ï¼‰
            const colors = ['#FFD700', '#00FFFF', '#FF1493', '#FFFFFF'];
            shockwave.style.borderColor = colors[Math.floor(Math.random() * colors.length)];
            
            // åº”ç”¨å†²å‡»æ³¢åŠ¨ç”»
            shockwave.style.animation = `shockwave-expand 1.5s ease-out forwards`;
            
            fireworksContainer.appendChild(shockwave);
        }
        
        /**
         * æ’­æ”¾çƒŸèŠ±éŸ³æ•ˆ
         */
        function playFireworksSound() {
            try {
                fireworksSound.currentTime = 0;
                const playPromise = fireworksSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('çƒŸèŠ±éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
                    });
                }
            } catch (error) {
                console.log('çƒŸèŠ±éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }

        // ========== å°é»„äººç‰¹æ•ˆå‡½æ•° ==========
        
        /**
         * åˆ›å»ºå°é»„äººæˆåŠŸç‰¹æ•ˆ
         * åŒ…å«å¤šä¸ªå°é»„äººä»å±å¹•åº•éƒ¨è·³è·ƒè¿›å…¥ï¼Œé…åˆæ–‡å­—æç¤º
         */
        function createMinionsAnimation() {
            // æ¸…ç©ºå°é»„äººå®¹å™¨
            minionsContainer.innerHTML = '';
            // æ˜¾ç¤ºå°é»„äººå®¹å™¨
            minionsContainer.style.display = 'block';
            
            // æ ¹æ®å±å¹•å°ºå¯¸ç¡®å®šå°é»„äººæ•°é‡
            const screenWidth = window.innerWidth;
            const minionCount = screenWidth < 768 ? 3 : 5; // å°å±å¹•3ä¸ªï¼Œå¤§å±å¹•5ä¸ª
            
            // åˆ›å»ºå¤šä¸ªå°é»„äºº
            for (let i = 0; i < minionCount; i++) {
                // è®¡ç®—æ¯ä¸ªå°é»„äººçš„ä½ç½®å’ŒåŠ¨ç”»å‚æ•°
                const startX = (screenWidth / (minionCount + 1)) * (i + 1);
                const midX = startX + (Math.random() - 0.5) * 100; // ä¸­é—´ä½ç½®éšæœºåç§»
                const endX = startX + (Math.random() - 0.5) * 50;  // æœ€ç»ˆä½ç½®éšæœºåç§»
                
                // å»¶è¿Ÿæ¯ä¸ªå°é»„äººçš„å‡ºç°æ—¶é—´ï¼Œå½¢æˆè¿ç»­æ•ˆæœ
                setTimeout(() => {
                    createMinion(startX, midX, endX);
                }, i * 200); // æ¯ä¸ªå°é»„äººé—´éš”200ms
            }
            
            // æ’­æ”¾å°é»„äººéŸ³æ•ˆ
            playMinionsSound();
            
            // æ˜¾ç¤ºæˆåŠŸæ–‡å­—æç¤º
            setTimeout(() => {
                showSuccessMessageMinions();
            }, 800);
            
            // 4ç§’åè‡ªåŠ¨éšè—å°é»„äººå’Œæ–‡å­—æç¤º
            setTimeout(() => {
                minionsContainer.style.display = 'none';
                hideSuccessMessageMinions();
            }, 4000);
        }
        
        /**
         * åˆ›å»ºå•ä¸ªå°é»„äºº
         * @param {number} startX - èµ·å§‹Xåæ ‡
         * @param {number} midX - ä¸­é—´Xåæ ‡
         * @param {number} endX - ç»“æŸXåæ ‡
         */
        function createMinion(startX, midX, endX) {
            // åˆ›å»ºå°é»„äººå®¹å™¨
            const minion = document.createElement('div');
            minion.className = 'minion';
            
            // è®¾ç½®CSSå˜é‡ç”¨äºåŠ¨ç”»æ§åˆ¶
            minion.style.setProperty('--start-x', `${startX}px`);
            minion.style.setProperty('--mid-x', `${midX}px`);
            minion.style.setProperty('--end-x', `${endX}px`);
            
            // åº”ç”¨è·³è·ƒåŠ¨ç”»
            minion.style.animation = `minion-jump 3s ease-out forwards`;
            
            // åˆ›å»ºå°é»„äººèº«ä½“
            const body = document.createElement('div');
            body.className = 'minion-body';
            
            // åˆ›å»ºèƒŒå¸¦è£¤
            const overalls = document.createElement('div');
            overalls.className = 'minion-overalls';
            
            // åˆ›å»ºèƒŒå¸¦
            const strapLeft = document.createElement('div');
            strapLeft.className = 'minion-strap left';
            const strapRight = document.createElement('div');
            strapRight.className = 'minion-strap right';
            
            // åˆ›å»ºå¤´éƒ¨
            const head = document.createElement('div');
            head.className = 'minion-head';
            
            // åˆ›å»ºæŠ¤ç›®é•œ
            const goggles = document.createElement('div');
            goggles.className = 'minion-goggles';
            const gogglesInner = document.createElement('div');
            gogglesInner.className = 'goggles-inner';
            
            // åˆ›å»ºçœ¼ç›
            const eyeLeft = document.createElement('div');
            eyeLeft.className = 'minion-eye left';
            const eyeRight = document.createElement('div');
            eyeRight.className = 'minion-eye right';
            
            // åˆ›å»ºå˜´å·´
            const mouth = document.createElement('div');
            mouth.className = 'minion-mouth';
            const mouthInner = document.createElement('div');
            mouthInner.className = 'mouth-inner';
            
            // åˆ›å»ºæ‰‹éƒ¨
            const handLeft = document.createElement('div');
            handLeft.className = 'minion-hand left';
            // æ·»åŠ æŒ¥æ‰‹åŠ¨ç”»
            handLeft.style.animation = 'minion-wave 1s 1s infinite alternate';
            
            const handRight = document.createElement('div');
            handRight.className = 'minion-hand right';
            // æ·»åŠ æŒ¥æ‰‹åŠ¨ç”»
            handRight.style.animation = 'minion-wave-right 1s 1.2s infinite alternate';
            
            // åˆ›å»ºè…¿éƒ¨
            const legLeft = document.createElement('div');
            legLeft.className = 'minion-leg left';
            const legRight = document.createElement('div');
            legRight.className = 'minion-leg right';
            
            // ç»„è£…å°é»„äºº
            goggles.appendChild(gogglesInner);
            gogglesInner.appendChild(eyeLeft);
            gogglesInner.appendChild(eyeRight);
            
            head.appendChild(goggles);
            head.appendChild(mouth);
            mouth.appendChild(mouthInner);
            
            body.appendChild(strapLeft);
            body.appendChild(strapRight);
            body.appendChild(overalls);
            body.appendChild(handLeft);
            body.appendChild(handRight);
            body.appendChild(legLeft);
            body.appendChild(legRight);
            
            minion.appendChild(head);
            minion.appendChild(body);
            
            // æ·»åŠ åˆ°å®¹å™¨
            minionsContainer.appendChild(minion);
        }
        
        /**
         * æ˜¾ç¤ºå°é»„äººæˆåŠŸæ–‡å­—æç¤º
         */
        function showSuccessMessageMinions() {
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            successMessageMinions.style.display = 'block';
            
            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            successMessageMinions.style.animation = 'none';
            successMessageMinions.offsetHeight; // è§¦å‘é‡ç»˜
            
            // åº”ç”¨å‡ºç°åŠ¨ç”»
            successMessageMinions.style.animation = 'minions-text-appear 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
        }
        
        /**
         * éšè—å°é»„äººæˆåŠŸæ–‡å­—æç¤º
         */
        function hideSuccessMessageMinions() {
            // å…ˆåº”ç”¨æ¶ˆå¤±åŠ¨ç”»
            successMessageMinions.style.animation = 'minions-text-disappear 0.5s ease-out forwards';
            
            // åŠ¨ç”»å®Œæˆåéšè—å…ƒç´ 
            setTimeout(() => {
                successMessageMinions.style.display = 'none';
                successMessageMinions.style.animation = '';
            }, 500);
        }
        
        /**
         * æ’­æ”¾å°é»„äººéŸ³æ•ˆ
         */
        function playMinionsSound() {
            try {
                minionsSound.currentTime = 0;
                const playPromise = minionsSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('å°é»„äººéŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
                    });
                }
            } catch (error) {
                console.log('å°é»„äººéŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }

        // ========== å°ä¸‘åŠ¨ç”»å‡½æ•°ï¼ˆå¤±è´¥ç‰¹æ•ˆï¼Œä¿ç•™ï¼‰ ==========
        
        /**
         * åˆ›å»ºå°ä¸‘åŠ¨ç”»ç‰¹æ•ˆ
         */
        function createClownAnimation() {
            // æ¸…ç©ºå°ä¸‘å®¹å™¨
            clownContainer.innerHTML = '';
            // æ˜¾ç¤ºå°ä¸‘å®¹å™¨
            clownContainer.style.display = 'block';
            
            // åˆ›å»ºå±å¹•çº¢è‰²é—ªçƒæ•ˆæœ
            addScreenRedFlash();
            
            // åˆ›å»ºå°ä¸‘é¢éƒ¨
            const clownFace = document.createElement('div');
            clownFace.className = 'clown-face';
            
            // åˆ›å»ºå°ä¸‘çœ¼ç›
            const leftEye = document.createElement('div');
            leftEye.className = 'clown-eye left';
            const leftPupil = document.createElement('div');
            leftPupil.className = 'clown-pupil';
            leftEye.appendChild(leftPupil);
            
            const rightEye = document.createElement('div');
            rightEye.className = 'clown-eye right';
            const rightPupil = document.createElement('div');
            rightPupil.className = 'clown-pupil';
            rightEye.appendChild(rightPupil);
            
            // åˆ›å»ºå°ä¸‘é¼»å­
            const nose = document.createElement('div');
            nose.className = 'clown-nose';
            
            // åˆ›å»ºå°ä¸‘å˜´å·´
            const mouth = document.createElement('div');
            mouth.className = 'clown-mouth';
            const mouthInner = document.createElement('div');
            mouthInner.className = 'mouth-inner-clown';
            mouth.appendChild(mouthInner);
            
            // åˆ›å»ºå°ä¸‘å¸½å­
            const hat = document.createElement('div');
            hat.className = 'clown-hat';
            const pompom = document.createElement('div');
            pompom.className = 'hat-pompom';
            hat.appendChild(pompom);
            
            // ç»„è£…å°ä¸‘
            clownFace.appendChild(leftEye);
            clownFace.appendChild(rightEye);
            clownFace.appendChild(nose);
            clownFace.appendChild(mouth);
            clownFace.appendChild(hat);
            
            // æ·»åŠ åˆ°å®¹å™¨
            clownContainer.appendChild(clownFace);
            
            // åˆ›å»ºè£…é¥°å…ƒç´ 
            createClownDecorations();
            
            // æ˜¾ç¤ºå¤±è´¥æ–‡å­—
            setTimeout(() => {
                showFailMessage();
            }, 800);
            
            // 3.5ç§’åè‡ªåŠ¨éšè—å°ä¸‘å’Œå¤±è´¥æç¤º
            setTimeout(() => {
                clownContainer.style.display = 'none';
                hideFailMessage();
            }, 3500);
        }
        
        /**
         * åˆ›å»ºå°ä¸‘è£…é¥°å…ƒç´ 
         */
        function createClownDecorations() {
            const decorationCount = 15;
            
            for (let i = 0; i < decorationCount; i++) {
                const decoration = document.createElement('div');
                decoration.className = 'fail-decoration';
                
                // éšæœºå¤§å°
                const size = 10 + Math.random() * 20;
                decoration.style.width = `${size}px`;
                decoration.style.height = `${size}px`;
                
                // éšæœºé¢œè‰²
                const colors = ['#ff3366', '#ffcc00', '#3366ff', '#66ff66'];
                decoration.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºä½ç½®å’ŒåŠ¨ç”»å‚æ•°
                const startX = Math.random() * window.innerWidth;
                const startY = Math.random() * window.innerHeight;
                const midX = window.innerWidth / 2 + (Math.random() - 0.5) * 200;
                const midY = window.innerHeight / 2 + (Math.random() - 0.5) * 200;
                const endX = window.innerWidth / 2 + (Math.random() - 0.5) * 100;
                const endY = window.innerHeight / 2 + (Math.random() - 0.5) * 100;
                
                decoration.style.setProperty('--start-x', `${startX}px`);
                decoration.style.setProperty('--start-y', `${startY}px`);
                decoration.style.setProperty('--mid-x', `${midX}px`);
                decoration.style.setProperty('--mid-y', `${midY}px`);
                decoration.style.setProperty('--end-x', `${endX}px`);
                decoration.style.setProperty('--end-y', `${endY}px`);
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                const delay = Math.random() * 0.5;
                
                decoration.style.animation = `decoration-fly-in 1.5s ${delay}s forwards`;
                
                clownContainer.appendChild(decoration);
            }
        }
        
        /**
         * æ·»åŠ å±å¹•çº¢è‰²é—ªçƒæ•ˆæœ
         */
        function addScreenRedFlash() {
            const flashOverlay = document.createElement('div');
            flashOverlay.style.position = 'fixed';
            flashOverlay.style.top = '0';
            flashOverlay.style.left = '0';
            flashOverlay.style.width = '100vw';
            flashOverlay.style.height = '100vh';
            flashOverlay.style.pointerEvents = 'none';
            flashOverlay.style.zIndex = '1499'; // ä½äºå°ä¸‘
            flashOverlay.style.animation = 'screen-red-flash 1.5s ease-out forwards';
            
            document.body.appendChild(flashOverlay);
            
            setTimeout(() => {
                if (flashOverlay.parentNode) {
                    flashOverlay.parentNode.removeChild(flashOverlay);
                }
            }, 1500);
        }
        
        /**
         * æ˜¾ç¤ºå¤±è´¥æ–‡å­—æç¤º
         */
        function showFailMessage() {
            // æ˜¾ç¤ºå¤±è´¥æ¶ˆæ¯
            failMessage.style.display = 'block';
            
            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            failMessage.style.animation = 'none';
            failMessage.offsetHeight;
            
            // åº”ç”¨å‡ºç°åŠ¨ç”»
            failMessage.style.animation = 'fail-text-appear 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
        }
        
        /**
         * éšè—å¤±è´¥æ–‡å­—æç¤º
         */
        function hideFailMessage() {
            failMessage.style.display = 'none';
            failMessage.style.animation = '';
        }

        // ========== éŸ³æ•ˆæ’­æ”¾å‡½æ•° ==========
        
        /**
         * æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
         */
        function playSuccessSound() {
            try {
                successSound.currentTime = 0;
                const playPromise = successSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('æˆåŠŸéŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
                    });
                }
            } catch (error) {
                console.log('æˆåŠŸéŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }
        
        /**
         * æ’­æ”¾å¤±è´¥éŸ³æ•ˆ
         */
        function playFailSound() {
            try {
                failSound.currentTime = 0;
                const playPromise = failSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('å¤±è´¥éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
                    });
                }
            } catch (error) {
                console.log('å¤±è´¥éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }

        // ========== æäº¤ç­”æ¡ˆå¤„ç† ==========
        
        /**
         * å¤„ç†æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
         */
        function handleSubmit() {
            if (submitBtn.disabled) return;

            let isAllCorrect = true;

            // æ£€æŸ¥ç”¨æˆ·ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
            for (const [qId, aId] of Object.entries(correctAnswers)) {
                if (userAnswers[qId] !== aId) {
                    isAllCorrect = false;
                    break;
                }
            }

            if (isAllCorrect) {
                // å…¨éƒ¨æ­£ç¡® - æ˜¾ç¤ºå°é»„äººç‰¹æ•ˆ + çƒŸèŠ±ç‰¹æ•ˆ
                playSuccessSound();
                createMinionsAnimation(); // å°é»„äººç‰¹æ•ˆ
                createFireworks(); // çƒŸèŠ±ç‰¹æ•ˆï¼ˆæ–°å¢ï¼‰
                
                // 4.5ç§’åé‡ç½®æ¸¸æˆï¼ˆæ¯”æˆåŠŸæƒ…å†µç¨é•¿ï¼Œä¸çƒŸèŠ±åŠ¨ç”»åŒæ­¥ï¼‰
                setTimeout(resetGame, 4500);
            } else {
                // ç­”æ¡ˆé”™è¯¯ - æ˜¾ç¤ºå°ä¸‘ç‰¹æ•ˆ
                playFailSound();
                
                // ç§»åŠ¨ç«¯éœ‡åŠ¨åé¦ˆ
                if (navigator.userAgent.match(/Mobile/) && 'vibrate' in navigator) {
                    navigator.vibrate([100, 50, 100]); // æ›´å¼ºçš„éœ‡åŠ¨æ¨¡å¼
                }
                
                // æ˜¾ç¤ºå°ä¸‘åŠ¨ç”»
                createClownAnimation();
                
                // 3.5ç§’åé‡ç½®æ¸¸æˆï¼ˆæ¯”æˆåŠŸæƒ…å†µç¨çŸ­ï¼‰
                setTimeout(resetGame, 3500);
            }
        }

        // ========== æ¸¸æˆé‡ç½® ==========
        
        /**
         * é‡ç½®æ¸¸æˆåˆ°åˆå§‹çŠ¶æ€
         */
        function resetGame() {
            // ç§»é™¤æ‰€æœ‰æ­£å¼è¿çº¿
            svgContainer.querySelectorAll('.line-path').forEach(line => line.remove());
            
            // æ¸…ç©ºç”¨æˆ·ç­”æ¡ˆ
            Object.keys(userAnswers).forEach(key => delete userAnswers[key]);
            
            // ç¦ç”¨æäº¤æŒ‰é’®
            submitBtn.disabled = true;
            
            // é‡ç½®æ‹–æ‹½çŠ¶æ€
            isDragging = false;
            startItem = null;
            
            // æ¸…ç†ä¸´æ—¶è¿çº¿
            if (tempLinePath) {
                tempLinePath.remove();
                tempLinePath = null;
            }
            
            // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„æ ·å¼
            allCards.forEach(item => {
                item.classList.remove('dragging', 'selected', 'active-state');
            });
            
            // éšè—æ‰€æœ‰ç‰¹æ•ˆå®¹å™¨
            fireworksContainer.style.display = 'none'; // æ–°å¢ï¼šéšè—çƒŸèŠ±å®¹å™¨
            minionsContainer.style.display = 'none';
            clownContainer.style.display = 'none';
            
            // éšè—æ‰€æœ‰æ–‡å­—æç¤º
            hideSuccessMessageMinions();
            hideFailMessage();
        }

        // ========== SVGå°ºå¯¸é€‚é… ==========
        
        /**
         * è°ƒæ•´SVGå°ºå¯¸ä»¥é€‚åº”è¿çº¿åŒºåŸŸ
         */
        function resizeSVG() {
            const rect = connectArea.getBoundingClientRect();
            svgContainer.setAttribute('width', rect.width);
            svgContainer.setAttribute('height', rect.height);
            redrawExistingLines();
        }

        /**
         * é‡ç»˜å·²æœ‰çš„è¿çº¿
         */
        function redrawExistingLines() {
            svgContainer.querySelectorAll('.line-path').forEach(line => line.remove());
            
            for (const [qId, aId] of Object.entries(userAnswers)) {
                const startItem = document.querySelector(`.left-card[data-id="${qId}"]`);
                const endItem = document.querySelector(`.right-card[data-answer="${aId}"]`);
                
                if (startItem && endItem) {
                    createCurvedLine(startItem, endItem, qId);
                    startItem.classList.add('selected');
                    endItem.classList.add('selected');
                }
            }
        }

        // ========== é¡µé¢åŠ è½½å®Œæˆåˆå§‹åŒ– ==========
        
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

    